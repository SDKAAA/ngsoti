---
title: Kunai Updates
author:
- Quentin JEROME
date: 04/07/2024
theme: circl
# 4:3 slide deck
aspectratio: 169
# setting color links to true
# turns them to be brown-ish
colorlinks: true
linkcolor: circlBlue
institute: Computer Incident Response Center Luxembourg (CIRCL)
themeoptions:
  - numbering=fraction
  - progressbar=frametitle
  - tlp=clear
---

#
::: {.latex}
\section{Introduction}
:::

# Brief History
\tocinclude

Project^[[https://github.com/kunai-project/kunai](https://github.com/kunai-project/kunai)] started **end-2022** as a "good first Rust project":

**12/2022 - 01/2024**: worked on it under my own company  
**since 01/2024**: joined **CIRCL** and working on the project in the context of an EU co-funded project

Why starting such a project:

* I was disappointed by **Sysmon for Linux** for many reasons
* Yet there are many good ideas in Sysmon and I think we can do much better by:
  * getting rid of XML (for configuration and events)
  * do not transpose something primarily done for Windows into Linux

# What can we do with Kunai ?
\tocinclude

An **open-source** monitoring tool designed for threat-detection/hunting

* Monitor many **events**^[[https://why.kunai.rocks/docs/category/kunai---events](https://why.kunai.rocks/docs/category/kunai---events)] (execve, shared object loaded, BPF programs loaded, files read/write/delete ...)
* Events comes with the following:
  * Relevant information to build solid **behavioral detections**
  * In chronological order
  * Grouping capability through a uuid
  * Parent/child tracking
  * Enriched with data from previous events (i.e. network connect/send)
* Accurately track security events generated by Linux container solutions

# 
\section{What's new since last public talk ?}

# Add Missing events
\tocinclude

* Clone
  * improves task tracking
* Prctl
  * some malware use this to change task name
* File Unlink (i.e. deletion)
  * to be able to detect crypto-lockers
* Bpf Socket Filter (used to filter specific network traffic on a socket)
  * used by BPFDoor^[[https://github.com/gwillgues/BPFDoor/blob/main/bpfdoor.c](https://github.com/gwillgues/BPFDoor/blob/main/bpfdoor.c)] malware on a raw socket

# Tacking a Step Back 

::: {.latex}
\begin{center}
  \includegraphics[height=0.8\textheight]{img/meme-great-stuff.jpg}
\end{center}
:::

# Filtering rules
\tocinclude

Kunai generates a lot of activity, it was already possible to turn **on/off** events but there is a need for **event filtering** :

1. reduce noise
2. without context a security alert is **useless** !

::: {.latex}
\begin{center}
 \includegraphics[height=0.5\textheight]{img/filtering-rule.png}
\end{center}
:::

# Detection rules
\tocinclude

Addresses the need to detect a very specific pattern

::: {.latex}
\begin{center}
  \includegraphics[height=0.7\textheight]{img/detection-rule.png}
\end{center}
:::

# Detection rules

::: {.latex}
\begin{center}
  \includegraphics[height=0.7\textheight]{img/detection-rule-meta.png}
\end{center}
:::

# Configuration with IoCs
\tocinclude

Kunai uses a straightforward **IoC format**
 
 ```json
 {"uuid": "ioc_uuid", "source":"Some IoC source", "value":"ioc_value"}
 ```

 1. kunai perfectly know which field of its events can be an IoC
 2. so it takes only a few lookups (per events) in a **hash map** 

This make **IoC scanning** very fast and not depending on the number
of **IoCs** being loaded

# IoC Provider Integration

* So far it is integrated with **MISP** through the **misp-to-kunai.py** ^[[misp-to-kunai.py](https://github.com/kunai-project/tools/blob/main/misp/misp-to-kunai.py)]
  * Can be configured to ingest **MISP feeds** (no API key needed) 
  * Can be configured to export events from a given MISP instance (API key needed)
  * Able to run as a service to regularly pull updates

This script lives in a repository ^[[kunai tools repository](https://github.com/kunai-project/tools)] where you can find other **tools** (mainly written in Python)

# 
::: {.latex}
\begin{center}
  \LARGE{Demo}
\end{center}
:::

# Conclusion / Future Work
\tocinclude

Kunai is a fairly young project but we believe it can bring added value to the Linux
ecosystem and more precisely as a cheap, free and open solution to make advanced
threat hunting and detection. Many improvements are foreseen to make it even more
powerful:

* make it capable of executing **actions** defined in detection rules
  * kill process, dump memory, collect information ...
* embed a Yara scanning engine using the very recent **Yara-X**^[[https://github.com/VirusTotal/yara-x](https://github.com/VirusTotal/yara-x)]
  * trigger scan as an **action** or to scan every file executed
* continuous integration
  * add several Linux distributions testing in CI/CD
  * monitor kernel changes impacting kunai functionalities

# Final Words

\begin{center}
  Q \& A

  Do you want to practice ?

  Join workshop on friday morning ;)
\end{center}

## References:

- Project:       [https://github.com/kunai-project/](https://github.com/kunai-project/)  
- Documentation: [https://why.kunai.rocks/docs/quickstart](https://why.kunai.rocks/docs/quickstart)
- Tools:         [https://github.com/kunai-project/tools](https://github.com/kunai-project/tools)

# 
::: {.latex}
\begin{center}
  \LARGE{Thank you all !}
  \vfill
\end{center}
:::

Kunai is an **Open-Source project** developed in the context of **NGSOTI** a co-funded project under
**DEP** (Digital Europe Programme) via the **ECCC** (European Cybersecurity Competence Centre) and the **CIRCL** (Computer Incident Response Center Luxembourg).

Funded by the European Union. Views and opinions expressed are however those of the author(s) only
and do not necessarily reflect those of the European Union or ECCC. Neither
the European Union nor the granting authority can be held responsible for them.

::: {.latex}
\begin{center}
  \vfill
  \includegraphics[width=0.4\textwidth]{img/eccc-logo.png}
  \hfill
  \includegraphics[width=0.4\textwidth]{img/eu-co-funded-en.jpg}
\end{center}
:::